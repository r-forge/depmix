# # Started by Ingmar Visser & Maarten Speekenbrink, 16-5-2007# # Usage: go to trunk directory and source this file in R, if the program# still works it should return TRUE at every test (or make immediate sense# otherwise)# # Changes: # 1) added Rdonlp examples with constraints on 26-2-2008# # # Test optimization using Rdonlp2# setwd("/Users/ivisser/Documents/projects/depmixProject/depmixNew/rforge/depmix/trunk/")source("depmixS4.r")source("classes.r")source("hmModel.R")source("fithmModel.R")source("llratio.R")source("lystig.R")source("fb.R")load("data/speed.Rda")rModels <- list(  list(	rModel(formula=rt~1,data=speed,family=gaussian()),#,pstart=c(5.52,.2)	rModel(formula=corr~1,data=speed,family=multinomial())),  list(	rModel(formula=rt~1,data=speed,family=gaussian()),#,pstart=c(6.39,.24)	rModel(formula=corr~1,data=speed,family=multinomial()))#,pstart=c(.098,.902))instart=c(0.5,.5)trstart1=c(0.896,0.104,0.084,0.916)trstart2=c(trstart[1:2],0,0.01,trstart[3:4],0,0)mod <- depmix(rModels=rModels,data=speed,transition=~1,trstart=trstart1,instart=instart)logLik(mod)fmod <- em(mod,ver=T)# fit the modelmod1 <- fit(mod)ll <- logLik(mod1)cat("Test 1: ", ll, "(loglike of speed data with covariate, hopefully better than 300.5701) \n")# # now constrain the initial state probs to be 0 and 1# also constrain the guessing probs to be 0.5 and 0.5 # rModels <- list(  list(	rModel(formula=rt~1,data=speed,family=gaussian(),pstart=c(5.52,.2)),	rModel(formula=corr~1,data=speed,family=multinomial())),  list(	rModel(formula=rt~1,data=speed,family=gaussian(),pstart=c(6.39,.24)),	rModel(formula=corr~1,data=speed,family=multinomial(),pstart=c(.098,.902))))instart=c(0,1)trstart=c(0.896,0.104,0.084,0.916)trstart=c(trstart[1:2],0,0.01,trstart[3:4],0,0)mod <- depmix(rModels=rModels,data=speed,transition=~Pacc,trstart=trstart,instart=instart)# set the starting values of this model to the optimized # values of the previously fitted model to speed optimizationpars <- c(unlist(getpars(mod1)))# set some to other values, ie the ones that we want to constrainpars[2]=+Infpars[14]=0mod <- setpars(mod,pars)# fix some parametersfree <- c(0,0,rep(c(0,1),4),1,1,0,0,1,1,0,1)mod2 <- fit(mod,fixed=!free)llratio(mod1,mod2)cat("Test 2: likelihood ratio not significant, hence mod2 better than mod1.\n")# # NOW ADD SOME GENERAL LINEAR CONSTRAINTS# rModels <- list(  list(	rModel(formula=rt~1,data=speed,family=gaussian(),pstart=c(5.52,.2)),	rModel(formula=corr~1,data=speed,family=multinomial())),  list(	rModel(formula=rt~1,data=speed,family=gaussian(),pstart=c(6.39,.24)),	rModel(formula=corr~1,data=speed,family=multinomial(),pstart=c(.098,.902))))instart=c(0,1)trstart=c(0.896,0.104,0.084,0.916)trstart=c(trstart[1:2],0,0.01,trstart[3:4],0,0)mod <- depmix(rModels=rModels,data=speed,transition=~Pacc,trstart=trstart,instart=instart)# set the starting values of this model to the optimized # values of the previously fitted model to speed optimizationpars <- c(unlist(getpars(mod2)))mod <- setpars(mod,pars)# start with fixed and free parametersconpat <- c(0,0,rep(c(0,1),4),1,1,0,0,1,1,0,1)# constrain the beta's on the transition parameters to be equalconpat[4] <- conpat[8] <- 2conpat[6] <- conpat[10] <- 3mod3 <- fit(mod,equal=conpat)llratio(mod2,mod3)cat("Test3: log Likelihood ratio significant, constraints not tenable.")