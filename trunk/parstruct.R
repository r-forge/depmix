setClass("ConstraintsList",  contains="list")setClass("BoxConstraintsList",  contains="ConstraintsList",  representation(	min="numeric",	max="numeric"  ))setClass("LinConstraintsList",  contains="ConstraintsList",  representation(	Amat = "matrix",	bvec = "numeric"  ))setClass("ParStruct",  representation(	id="integer", # for equivalence constraints	fix="logical", # TRUE is fixed, FALSE is free	constraints="ConstraintsList", # for later use	replicate="logical" # switch to indicate identical parameters for each nrep  ))setClass("NTimes",  representation(	n="integer",	cases="integer",	bt="integer",	et="integer"  ))nTimes <- function(ntimes) {  lt <- length(ntimes)  et <- cumsum(ntimes)  bt <- c(1,et[-lt]+1)  out <- new("NTimes",	n=as.integer(ntimes),	cases=as.integer(lt),	bt=as.integer(bt),	et=as.integer(et)  )  out}setClass("McplBaseModel",  representation(	x="matrix",	y="matrix",	parameters="list",	parStruct="ParStruct",	nTimes="NTimes"  ))setMethod("getPars",signature(object="McplBaseModel"),  # Note:  # if one element in parameters corresponding to id[i] is free, so  #   is this parameter!  function(object,which="all",...) {	pars <- unlist(object@parameters)	switch(which,	  free = {		parid <- object@parStruct@id		fix <- object@parStruct@fix		if(length(parid)>0) {		  # get unique parameters		  if(length(fix)>0) parid.v <- unique(parid[!fix]) else parid.v <- unique(parid)		  parid.n <- length(parid.v)		  newpars <- vector()		  for(i in 1:parid.n) newpars[i] <- pars[which(parid==parid.v[i])[1]]		  pars <- newpars		} else {		  if(length(fix)>0) {			if(length(fix) == length(pars)) pars <- pars[!fix] else stop("length of fix in parStruct does not match number of parameters")		  }		}		if(length(pars)==0) pars <- NULL		pars	  },	  all = pars,	  pars	)	return(pars)  })setMethod("setPars",signature(object="McplBaseModel"),  function(object,pars,...,rval=c("object","parameters")) {	rval <- match.arg(rval)	oldpars <- unlist(object@parameters)	if(length(pars) > 0) {	  if(length(pars)!=length(oldpars)) {		parid <- object@parStruct@id		fix <- object@parStruct@fix		if(length(parid)>0) {		  if(length(fix)>0) parid.v <- unique(parid[!fix]) else parid.v <- unique(parid)		  parid.n <- length(parid.v)		  if(length(pars)!=parid.n) stop("length of parid does not match length of pars")		  for(i in 1:parid.n) oldpars[which(parid==parid.v[i])] <- pars[i]		} else {		  if(length(fix)>0) {			if(sum(!fix)!=length(pars)) stop("parid not given and length of pars does not equal number of nonfixed parameters")			oldpars[!fix] <- pars		  } else {			stop("cannot work with par of this length in setPar")		  }		}	  } else {		oldpars <- pars	  }	  object@parameters <- relist(oldpars,skeleton=object@parameters)	}	switch(rval,	  object = object,	  parameters = object@parameters)  })